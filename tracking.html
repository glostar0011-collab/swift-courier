<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Tracking | SwiftCourier Global</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --purple: #4D148C; --orange: #FF6200; --navy: #050A18; --white: #FFFFFF; --bg: #F0F2F5; --green: #00C853; }
        * { box-sizing: border-box; transition: 0.3s; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--navy); }

        /* HEADER */
        header { background: var(--navy); padding: 25px 8%; display: flex; justify-content: space-between; align-items: center; color: white; border-bottom: 4px solid var(--purple); }
        .logo { font-family: 'Montserrat'; font-size: 24px; font-weight: 900; text-decoration: none; color: white; letter-spacing: -1px; }
        .logo span { color: var(--orange); }
        .sys-status { font-size: 11px; letter-spacing: 1px; opacity: 0.7; display: flex; align-items: center; }
        .blink { height: 8px; width: 8px; background: var(--green); border-radius: 50%; margin-right: 8px; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* HERO TRACKING STATUS */
        .status-hero { background: var(--purple); color: white; padding: 60px 8%; text-align: center; }
        .status-hero h1 { font-family: 'Montserrat'; font-size: 42px; margin: 0; }
        .status-hero p { opacity: 0.8; font-size: 14px; margin-top: 10px; text-transform: uppercase; letter-spacing: 2px; }

        /* MAIN DASHBOARD */
        .dashboard { max-width: 1300px; margin: -40px auto 100px; padding: 0 20px; display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }

        /* PROGRESS RADAR */
        .card { background: white; border-radius: 4px; padding: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.05); position: relative; }
        .progress-container { display: flex; justify-content: space-between; margin: 50px 0; position: relative; }
        .progress-line { position: absolute; top: 20px; left: 0; right: 0; height: 4px; background: #eee; z-index: 1; }
        .progress-fill { position: absolute; top: 20px; left: 0; height: 4px; background: var(--orange); z-index: 2; width: 0%; }
        .node { position: relative; z-index: 3; text-align: center; width: 100px; }
        .dot { width: 40px; height: 40px; background: white; border: 4px solid #eee; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-weight: 900; }
        .node.active .dot { border-color: var(--orange); color: var(--orange); }
        .node.completed .dot { background: var(--orange); border-color: var(--orange); color: white; }
        .node span { font-size: 10px; font-weight: 800; color: #999; text-transform: uppercase; }
        .node.active span { color: var(--navy); }

        /* LOGS TABLE */
        .logs-table { width: 100%; border-collapse: collapse; margin-top: 30px; }
        .logs-table th { text-align: left; font-size: 12px; color: #999; padding: 10px; border-bottom: 2px solid #eee; }
        .logs-table td { padding: 15px 10px; font-size: 14px; border-bottom: 1px solid #f9f9f9; }
        .log-status { font-weight: bold; color: var(--purple); }

        /* SIDEBAR */
        .spec-card { background: var(--navy); color: white; padding: 30px; border-radius: 4px; }
        .spec-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .spec-item label { opacity: 0.5; font-size: 12px; text-transform: uppercase; }
        .spec-item span { font-weight: bold; font-size: 14px; }
        
        .map-box { width: 100%; height: 250px; background: #111; margin-top: 20px; border-radius: 4px; overflow: hidden; }
        .download-btn { display: block; width: 100%; padding: 15px; background: var(--orange); color: white; text-align: center; text-decoration: none; font-weight: 900; font-size: 13px; margin-top: 20px; border-radius: 4px; }

        /* OVERLAYS */
        #loader-overlay { position: fixed; inset: 0; background: var(--navy); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .spinner { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); border-top-color: var(--orange); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 900px) { .dashboard { grid-template-columns: 1fr; } .progress-container { flex-direction: column; gap: 30px; } .progress-line { display: none; } }
    </style>
</head>
<body>

<div id="loader-overlay">
    <div class="spinner"></div>
    <div style="font-family: 'Montserrat'; letter-spacing: 2px; font-size: 12px;">ENCRYPTED CONNECTION ESTABLISHED</div>
</div>

<header>
    <a href="index.html" class="logo">SWIFT<span>COURIER</span></a>
    <div class="sys-status"><div class="blink"></div> SECURE DATA STREAM ACTIVE</div>
</header>

<div class="status-hero">
    <p id="hero-id-label">CONSIGNMENT IDENTIFIED</p>
    <h1 id="hero-status">---</h1>
</div>

<div class="dashboard">
    <div class="main-content">
        <div class="card">
            <h3>Shipment Lifecycle</h3>
            <div class="progress-container">
                <div class="progress-line"></div>
                <div class="progress-fill" id="p-bar"></div>
                <div class="node" id="n1"><div class="dot">1</div><span>Order Received</span></div>
                <div class="node" id="n2"><div class="dot">2</div><span>Processed</span></div>
                <div class="node" id="n3"><div class="dot">3</div><span>In Transit</span></div>
                <div class="node" id="n4"><div class="dot">4</div><span>Out for Delivery</span></div>
                <div class="node" id="n5"><div class="dot">5</div><span>Delivered</span></div>
            </div>

            <h3 style="margin-top: 60px;">Operational Audit Logs</h3>
            <table class="logs-table">
                <thead><tr><th>TIMESTAMP</th><th>LOCATION</th><th>ACTIVITY</th><th>STATUS</th></tr></thead>
                <tbody id="log-entries">
                    </tbody>
            </table>
        </div>
    </div>

    <aside>
        <div class="spec-card">
            <h3>Consignment Specs</h3>
            <div class="spec-item"><label>Tracking ID</label><span id="spec-id">---</span></div>
            <div class="spec-item"><label>Service Class</label><span>Premium Express</span></div>
            <div class="spec-item"><label>Weight</label><span id="spec-weight">---</span></div>
            <div class="spec-item"><label>Origin</label><span id="spec-origin">---</span></div>
            <div class="spec-item"><label>Destination</label><span id="spec-dest">---</span></div>
            
            <div class="map-box">
                <iframe id="map-frame" width="100%" height="100%" frameborder="0" style="border:0;"></iframe>
            </div>

            <a href="#" class="download-btn" onclick="alert('Generating Secure PDF Manifest...')">DOWNLOAD SHIPMENT MANIFEST</a>
        </div>

        <div style="margin-top: 30px; background: white; padding: 25px; border-left: 5px solid var(--purple);">
            <h4 style="margin:0 0 10px 0;">Premium Support</h4>
            <p style="font-size: 13px; color: #666; line-height: 1.6;">Your shipment is covered under SwiftCourier Global protection. For priority assistance, call +234 816 057 1418.</p>
        </div>
    </aside>
</div>

<script>
    const apiURL = 'https://script.google.com/macros/s/AKfycbxrZ2ZuqFVIAjEg8x16GXy1V0KHcMiqyJPH3PXeWnWYZizGCxy2kUKfjlcFYhos5FI/exec'; 

    async function fetchTrackingData() {
        const urlParams = new URLSearchParams(window.location.search);
        const trackId = urlParams.get('id');
        
        if (!trackId) {
            window.location.href = 'index.html';
            return;
        }

        try {
            const response = await fetch(`${apiURL}?id=${encodeURIComponent(trackId)}`);
            const data = await response.json();

            if (data && data.id) {
                renderMassiveData(data);
            } else {
                document.getElementById('loader-overlay').innerHTML = `
                    <h2 style="color:var(--orange)">CONSIGNMENT NOT FOUND</h2>
                    <button onclick="window.location.href='index.html'" style="padding:15px 30px; background:white; color:var(--navy); border:none; font-weight:bold; cursor:pointer; margin-top:20px;">BACK TO TERMINAL</button>
                `;
            }
        } catch (error) {
            document.getElementById('loader-overlay').innerText = "DATASTREAM INTERRUPTED. REFRESHING...";
            setTimeout(() => location.reload(), 3000);
        }
    }

    function renderMassiveData(data) {
        document.getElementById('loader-overlay').style.display = 'none';
        
        // Hero Section
        document.getElementById('hero-id-label').innerText = "CONSIGNMENT #" + data.id;
        document.getElementById('hero-status').innerText = data.status;

        // Specs
        document.getElementById('spec-id').innerText = data.id;
        document.getElementById('spec-weight').innerText = (data.weight || "N/A") + " kg";
        document.getElementById('spec-origin').innerText = data.origin || "International Hub";
        document.getElementById('spec-dest').innerText = data.destination || "Secured Address";
        
        // Map
        if(data.map) document.getElementById('map-frame').src = data.map;

        // Progress Logic
        const status = data.status.toLowerCase();
        let step = 1;
        let percent = 0;

        if (status.includes("origin") || status.includes("received")) { step = 1; percent = 5; }
        else if (status.includes("processed") || status.includes("departed")) { step = 2; percent = 25; }
        else if (status.includes("transit") || status.includes("shipped")) { step = 3; percent = 50; }
        else if (status.includes("out") || status.includes("delivery")) { step = 4; percent = 75; }
        else if (status.includes("delivered") || status.includes("arrived")) { step = 5; percent = 100; }

        document.getElementById('p-bar').style.width = percent + "%";
        for (let i = 1; i <= 5; i++) {
            const node = document.getElementById('n' + i);
            if (i < step) node.classList.add('completed');
            if (i === step) node.classList.add('active');
        }

        // Generate Massive Audit Logs (Mocked based on status)
        const logTable = document.getElementById('log-entries');
        const now = new Date();
        const logs = [
            { t: "12:40 PM", l: data.destination || "Dest.", a: "Final Delivery Stage", s: "IN PROGRESS" },
            { t: "09:15 AM", l: "Global Distribution", a: "Sorting & Quality Control", s: "COMPLETED" },
            { t: "Yesterday", l: data.origin || "Origin", a: "Air Freight Departure", s: "COMPLETED" }
        ];

        logTable.innerHTML = logs.map(l => `
            <tr>
                <td>${l.t}</td>
                <td>${l.l}</td>
                <td>${l.a}</td>
                <td class="log-status">${l.s}</td>
            </tr>
        `).join('');
    }

    fetchTrackingData();
</script>

</body>
</html>
